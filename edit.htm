<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="force-rendering" content="webkit">
<meta name="renderer" content="webkit">

<link rel="stylesheet" href="style.css" />
</head>
<body>
	<div class="window loading destroy" style="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);display:block">
		<div class="content"><h1>傻瓜弹曲</h1><p align="right">正在加载<span id="loadfile">调试器</span>…… </p></div>
	</div>
	<!-- script>
	    if(/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent))document.write('<scr'+'ipt src="http://cdn.jsdelivr.net/npm/eruda" onload="eruda.init()"></scr'+'ipt>');
	</script -->
	<script>loadfile.innerHTML = "网页内容布局"</script>
<noscript>
	<div class="window on">
		<div class="windowtitle">系统错误</div>
		<div class="content">您的浏览器不能运行</div>
	</div>
</noscript>

<div class="menu line" style="position:fixed">
	<div class="item">
		文件
		<div class="menu">
			<a href="javascript:(function(){localStorage.open = '{&#x22;music&#x22;:[]}';window.open(location.href.split('?')[0],'_blank','toolbar=no');})()">新建</a>
			<a href="javascript:UI.open();;">打开...</a>
			<a href="javascript:UI.saveAs();">另存为...</a>
			<hr>
			<div class="item">
				导出
				<div class="menu">
					<a href="javascript:;">导出音频...</a>
					<a href="javascript:;">导出HTML网页...`</a>
					<a href="javascript:;">复制链接</a>
				</div>
			</div>
			<a href="javascript:window.print();">打印...</a>
		</div>
	</div>
	<div class="item">
		编辑
		<div class="menu">
			<a href="javascript:;">撤销</a>
			<hr>
			<a href="javascript:UI.cut();">剪切</a>
			<a href="javascript:UI.copy();">复制</a>
			<a href="javascript:UI.paste();">粘贴</a>
			<hr>
			<div class="item">
				输入
				<div class="menu">
					<label><input onclick="UI.defaultLength = parseInt(this.value)" type="radio" value="4" name="eightorfore"/>输入默认八分音符</label>
					<label><input onclick="UI.defaultLength = parseInt(this.value)" type="radio" selected value="8" name="eightorfore"/>输入默认四分音符</label>
				</div>
			</div>
			<hr>
			<a href="javascript:;">自动定调...</a>
			<a href="javascript:;">拼音...</a>
			<hr>
			<div class="item">
				音符操作
				<div class="menu">
					<a href="javascript:(function(){for(var i=UI.selStart;i<=UI.selEnd;i++){Music.music[i].octave = Math.min(Music.music[i].octave+1,1)};UI.render();}())">升高八度</a>
					<a href="javascript:(function(){for(var i=UI.selStart;i<=UI.selEnd;i++){Music.music[i].octave = Math.max(Music.music[i].octave-1,-1)};UI.render();})()">降低八度</a>
					<a href="javascript:(function(){if(UI.selStart == -1){UI.selStart = UI.senEnd};Music.music[UI.selEnd].fx.triplets = true;UI.render()})();">制作三连音...</a>
				</div>
			</div>
			<div class="item">
				段落操作
				<div class="menu">
					<a href="javascript:(function(){for(var i=UI.selStart;i<=UI.selEnd;i++){Music.music[i].octave = Math.min(Music.music[i].octave+1,1)};UI.render();}())">升高八度</a>
					<a href="javascript:(function(){for(var i=UI.selStart;i<=UI.selEnd;i++){Music.music[i].octave = Math.max(Music.music[i].octave-1,-1)};UI.render();})()">降低八度</a>
					<a href="javascript:(function(){if(UI.selStart == -1){UI.selStart = UI.senEnd};Music.music[UI.selEnd].fx.triplets = true;UI.render()})();">制作三连音...</a>
				</div>
			</div>
		</div>
	</div>
	<div class="item">
		播放
		<div class="menu">
			<label><input type="checkbox" onclick="Player.sing();"/>播放/暂停</label>
			<hr>
			<label><input type="checkbox" checked onclick="Player.enableSMPlay = this.checked"/>编辑时奏音乐</label>
			<hr>
			<label><input type="checkbox" checked onclick="if(Player.enableVoice || Player.enableChord || this.checked){Player.enableMusic = this.checked}else{PopupWindow.alert('这三个选项我不想都不选。');return false;}"/>奏旋律</label>
			<label><input type="checkbox" checked onclick="if(this.checked || Player.enableChord || Player.enableMusic){Player.enableVoice = this.checked}else{PopupWindow.alert('这三个选项我不想都不选。');return false;}"/>唱人声</label>
			<label><input type="checkbox" checked onclick="if(Player.enableVoice || this.checked || Player.enableMusic){Player.enableChord = this.checked}else{PopupWindow.alert('这三个选项我不想都不选。');return false;}"/>奏伴奏</label>

			<hr>
			<label><input type="checkbox"/>使用节拍器</label>
		</div>
	</div>
	<div class="item">
		视图
		<div class="menu">
			<label><input type="checkbox" onclick="document.body.className=( this.checked?'fensanalign':'');UI.layout();"/>对齐最后一行</label>
		</div>
	</div>
	<div class="item">
		帮助
		<div class="menu">
			<a href="help/index.htm" onclick="alert('暂不提供帮助...');var win = true/*window.open(this.href,this.target,'toolbar=no,width=640,height=480')*/;if(win!=null){return false;}" target="help">帮助主题...</a>
			<hr>
			<a href="./" >关于...</a>
		</div>
	</div>
	<div class="item">和弦
		<div class="menu">
			<a onclick="PopupWindow.open(chordWindow)" target="help">手动输入</a>
			<a onclick="和弦标注(1)">新机械</a>
			<a onclick="转换为C调()" target="help">转换为C调</a>
			<a onclick="输出()" target="help">输出</a>
		</div>
	</div>
</div>
<div class="header">
	<center><input class="title" type="text" onchange="Music.title = this.value;document.title = this.value + ' - 傻瓜弹曲'" placeholder="请输入标题..."/></center>
	<br/><label>1 =
	<select class="arpeggio" size="1" style="max-width:1.7em;" onchange="Music.arpeggio = this.value;">
		<option value="-4">Ab</option>
		<option value="-3">A</option>
		<option value="-2">Bb</option>
		<option value="-1">B&emsp;（ bC ）</option>
		<option selected value="0">C</option>
		<option value="1">Db&emsp;（ C# ）</option>
		<option value="2">D</option>
		<option value="3">Eb</option>
		<option value="4">E</option>
		<option value="5">F</option>
		<option value="6">F#&emsp;（ bG ）</option>
		<option value="7">G</option>
	</select>
	</label><table style="display:inline-table">
	<tr>
		<td style="border-bottom:solid 1px">
			<input type="number" class="tempo1" onchange="Music.tempo[1] = parseInt(this.value);UI.render();" required value="4" max="12" min="1">
		</td>
	</tr>
	<tr>
		<td>
			<input type="number" class="tempo0" onchange="Music.tempo[0] = parseInt(this.value);UI.render();" required value="4" max="8" min="1" >
		</td>
	</tr>
	</table>
	&emsp;<label id="speedLabel" for="speed">速度：</label><input id="speed" required value="120" min="10" max="400" size="3" step="1" oninput="Music.speed=this.value" style="text-align:left" type="number">
	<textarea class="author" style="font-family: '宋体',monospace;float:right;text-align:right;overflow:hidden;" oninput='Music.author = this.value;' rows="3" cols="19"></textarea>
</div>
<div style="clear:both"></div>
<br>
<div id="coverOn" class="coverOn">
	<div id="caret" class="caret"></div>
	<input type="won't appear in the future" class="editbox"  autocorrect="fuck" autocapitalize="fuck" autocomplete="fuck"/>
	<span id="imetip" ></span>
</div>
<div class="container">
	正在加载中，请稍后...
</div>
<div class="status">
  <div>就绪</div>
  
</div>
<div class="menu" id="contextMenu" style="display:none;position:fixed;">
	<a href="javascript:UI.copy()">复制</a>
	<a href="javascript:UI.paste()">粘贴</a>
	<a href="javascript:UI.selStart = 0;UI.selEnd = 999999999999;UI.redraw();">全选</a>
	<a href="javascript:UI.insertEdit([])">删除</a>
	<hr>
	<a href="javascript:(function(){for(var i=UI.selStart;i<=UI.selEnd;i++){Music.music[i].octave = Math.min(Music.music[i].octave+1,1)};UI.render();}())">升高八度</a>
	<a href="javascript:(function(){for(var i=UI.selStart;i<=UI.selEnd;i++){Music.music[i].octave = Math.max(Music.music[i].octave-1,-1)};UI.render();})()">降低八度</a>
	<a href="javascript:(function(){if(UI.selStart == -1){UI.selStart = UI.selEnd};Music.music[UI.selStart].fx.triplets = true;UI.render()})();">制作三连音...</a>
</div>
<input type="file" id="openFile" style="display:none" onchange="UI.openListener(this)"/>
<script>
	if(! "eruda" in window)
	window.onerror = function(message, source, lineno, colno, error) {
		var ele = document.createElement("div");
		ele.className = "error";
		ele.innerHTML += "程序内部错误：<br />"+error+"<br />";
		ele.innerHTML += message;
		ele.innerHTML += "<br />在脚本文件 " + source + " 中<br /><br />";
		ele.innerHTML += "<br />第 " + lineno + " 行，第 " + colno + " 列<br /><br />";
		ele.innerHTML += "<br />刚才您进行的操作已经停止。请尝试另存为文件，这有可能减少数据的损失。<br /><br />";
		ele.innerHTML = '<input type="button" style="float:right" value="关闭" onclick="this.parentNode.parentNode.removeChild(this.parentNode)">' + ele.innerHTML;
		document.body.appendChild(ele);
	}
</script>
<script>loadfile.innerHTML = "程序主逻辑"</script>
<script src="js/Music.js"></script>
<script>loadfile.innerHTML = "拼音数据"</script>
<script src="js/PyData.js"></script>
<script>loadfile.innerHTML = "播放器"</script>
<script src="js/Player.js"></script>
<script>loadfile.innerHTML = "自动和弦器"</script>
<script src="js/Chord.js"></script>
<!--script>loadfile.innerHTML = "触摸兼容程序"</script>
<script src="js/touchShim.js"></script-->
<script>
	if(getComputedStyle( document.body,"::after").content != '"loaded"' ){
		var request = new XMLHttpRequest();
		request.open('GET', "style.css", true);
		request.onload = function(){
			var dom = document.createElement("style");
			dom.innerHTML = request.responseText;
			document.body.appendChild(dom)
		}
		request.send();
	}
	PopupWindow.close(document.querySelector(".loading"))
</script>
	<div class="window about on">
		<div class="windowtitle">关于...<button class="close"><b>×</b></button></div>
	</div>
	<div class="window on" id="chordWindow">
		<div class="windowtitle">手动输入和弦<button class="close"><b>×</b></button></div>
		<div class="content">
			<input id="chordinput" oninput="Chord(2)"/>
		</div>
	</div>
</body>
</html>